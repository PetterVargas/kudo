---
title: Control de Seguridad para Contenedores
description: Marco integral de seguridad para tecnolog√≠as de contenedores y orquestaci√≥n.
---

## üìã Informaci√≥n General

**Documento:** Control de Seguridad para Contenedores  
**Versi√≥n:** 1.0.0  
**Fecha:** Enero 2025  
**Clasificaci√≥n:** Confidencial  
**Audiencia:** Equipos de DevOps, SRE, desarrollo y arquitectura de DivisionCero

## üéØ Prop√≥sito

Establecer los controles y pr√°cticas de seguridad obligatorias para el uso de tecnolog√≠as de contenedores en DivisionCero, incluyendo Docker, Podman, Kubernetes y otras plataformas de orquestaci√≥n. Esta pol√≠tica garantiza que los entornos contenerizados mantengan los m√°s altos est√°ndares de seguridad desde el desarrollo hasta la producci√≥n.

## üè¢ Alcance

Esta pol√≠tica aplica a:
- Todos los contenedores utilizados en entornos de desarrollo, testing, staging y producci√≥n
- Im√°genes de contenedores, tanto propias como de terceros
- Plataformas de orquestaci√≥n como Kubernetes, Docker Swarm o similares
- Registros de contenedores p√∫blicos y privados
- Redes y almacenamiento asociados a contenedores
- Pipelines de CI/CD que utilicen contenedores
- Monitoreo y logging de entornos contenerizados

## üìö Definiciones

- **Contenedor:** Unidad de software que empaqueta c√≥digo y sus dependencias
- **Imagen de Contenedor:** Plantilla inmutable para crear contenedores
- **Registro de Contenedores:** Repositorio para almacenar y distribuir im√°genes
- **Orquestador:** Sistema para automatizar despliegue y gesti√≥n de contenedores
- **Runtime de Contenedores:** Software que ejecuta contenedores (Docker, containerd, CRI-O)
- **Namespace:** Mecanismo de aislamiento de recursos del kernel
- **Control Groups (cgroups):** Limitaci√≥n y aislamiento de recursos del sistema
- **Pod:** Unidad b√°sica de despliegue en Kubernetes que contiene uno o m√°s contenedores

## üõ°Ô∏è Pol√≠tica

### Principios Fundamentales

- **Inmutabilidad:** Las im√°genes de contenedores deben ser inmutables y versionadas
- **Principio de Menor Privilegio:** Contenedores deben ejecutarse con privilegios m√≠nimos
- **Aislamiento:** Separaci√≥n estricta entre cargas de trabajo mediante namespaces
- **Visibilidad:** Monitoreo y logging completo de actividades de contenedores
- **Hardening:** Configuraci√≥n segura de todos los componentes del stack de contenedores

### 1. Seguridad de Im√°genes de Contenedores

#### 1.1 Construcci√≥n de Im√°genes Seguras

**Controles Obligatorios:**
- Utilizar im√°genes base oficiales y actualizadas de proveedores confiables
- Implementar builds multi-stage para reducir superficie de ataque
- No incluir secretos, credenciales o informaci√≥n sensible en las im√°genes
- Ejecutar contenedores como usuario no privilegiado (non-root)
- Minimizar componentes instalados (principio de superficie m√≠nima)

**Dockerfile Seguro:**
```dockerfile
# ‚úÖ Usar imagen base oficial y espec√≠fica
FROM node:18.19-alpine3.19

# ‚úÖ Crear usuario no privilegiado
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nextjs -u 1001

# ‚úÖ Instalar solo dependencias necesarias
COPY package*.json ./
RUN npm ci --only=production && npm cache clean --force

# ‚úÖ Cambiar a usuario no privilegiado
USER nextjs

# ‚úÖ Configurar directorio de trabajo seguro
WORKDIR /app
COPY --chown=nextjs:nodejs . .

EXPOSE 3000
CMD ["npm", "start"]
```

#### 1.2 Escaneo de Vulnerabilidades

**Requerimientos:**
- Escaneo autom√°tico de todas las im√°genes antes del despliegue
- Uso de herramientas como Trivy, Clair, Anchore o Snyk
- Umbral m√°ximo de vulnerabilidades cr√≠ticas: 0
- Umbral m√°ximo de vulnerabilidades altas: 5
- Reporte autom√°tico de vulnerabilidades al equipo de seguridad

**Herramientas Recomendadas:**
```bash
# Escaneo con Trivy
trivy image --severity HIGH,CRITICAL myapp:latest

# Escaneo con Docker Scout
docker scout cves myapp:latest

# Integraci√≥n en CI/CD
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  aquasec/trivy:latest image --exit-code 1 --severity HIGH,CRITICAL myapp:latest
```

### 2. Seguridad de Registros de Contenedores

#### 2.1 Gesti√≥n de Registros

**Controles Obligatorios:**
- Usar registros privados para im√°genes internas
- Implementar autenticaci√≥n robusta para acceso a registros
- Habilitar firmado digital de im√°genes (Docker Content Trust)
- Configurar pol√≠ticas de retenci√≥n y limpieza
- Auditar accesos y descargas de im√°genes

#### 2.2 Pol√≠ticas de Admisi√≥n

**Kubernetes Admission Controllers:**
```yaml
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: disallow-latest-tag
spec:
  validationFailureAction: enforce
  background: false
  rules:
    - name: require-image-tag
      match:
        any:
        - resources:
            kinds:
            - Pod
      validate:
        message: "Latest tag is not allowed"
        pattern:
          spec:
            containers:
            - image: "!*:latest"
```

### 3. Seguridad del Runtime de Contenedores

#### 3.1 Configuraci√≥n Segura

**Docker/Podman Security:**
```bash
# ‚úÖ Ejecutar sin privilegios
docker run --user 1001:1001 --read-only --tmpfs /tmp myapp:latest

# ‚úÖ Limitar capacidades
docker run --cap-drop=ALL --cap-add=NET_BIND_SERVICE myapp:latest

# ‚úÖ Configurar l√≠mites de recursos
docker run --memory=512m --cpus=1.0 --pids-limit=100 myapp:latest

# ‚úÖ Usar redes personalizadas
docker network create --driver bridge myapp-network
docker run --network=myapp-network myapp:latest
```

#### 3.2 Aislamiento de Contenedores

**Controles Requeridos:**
- Usar namespaces de usuario para aislamiento adicional
- Configurar SELinux/AppArmor para control de acceso obligatorio
- Implementar seccomp para filtrado de syscalls
- Usar filesystem read-only cuando sea posible

### 4. Seguridad de Kubernetes

#### 4.1 Configuraci√≥n del Cl√∫ster

**API Server Security:**
```yaml
apiVersion: v1
kind: Config
clusters:
- cluster:
    server: https://k8s-api.divisioncero.com:6443
    certificate-authority-data: <CA_CERT>
  name: production-cluster
users:
- name: admin-user
  user:
    client-certificate-data: <CLIENT_CERT>
    client-key-data: <CLIENT_KEY>
contexts:
- context:
    cluster: production-cluster
    user: admin-user
  name: admin-context
```

#### 4.2 Pol√≠ticas de Seguridad de Pods

**Pod Security Standards:**
```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: production-apps
  labels:
    pod-security.kubernetes.io/enforce: restricted
    pod-security.kubernetes.io/audit: restricted
    pod-security.kubernetes.io/warn: restricted
---
apiVersion: v1
kind: Pod
metadata:
  name: secure-app
  namespace: production-apps
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1001
    fsGroup: 1001
    seccompProfile:
      type: RuntimeDefault
  containers:
  - name: app
    image: myapp:v1.2.3
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop: ["ALL"]
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"
```

#### 4.3 Network Policies

**Micro-segmentaci√≥n de Red:**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-all-ingress
  namespace: production-apps
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-app-to-db
  namespace: production-apps
spec:
  podSelector:
    matchLabels:
      app: web-app
  policyTypes:
  - Egress
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: database
    ports:
    - protocol: TCP
      port: 5432
```

### 5. Gesti√≥n de Secretos

#### 5.1 Kubernetes Secrets

**Mejores Pr√°cticas:**
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
  namespace: production-apps
type: Opaque
data:
  database-password: <base64-encoded-password>
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: secure-app
spec:
  template:
    spec:
      containers:
      - name: app
        image: myapp:v1.2.3
        env:
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: database-password
```

#### 5.2 Integraci√≥n con Gestores de Secretos

**HashiCorp Vault Integration:**
```yaml
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: vault-database
spec:
  provider: vault
  parameters:
    vaultAddress: "https://vault.divisioncero.com"
    roleName: "database-role"
    objects: |
      - objectName: "database-password"
        secretPath: "secret/data/database"
        secretKey: "password"
```

### 6. Monitoreo y Logging

#### 6.1 Observabilidad de Contenedores

**M√©tricas Requeridas:**
- Uso de CPU, memoria y red por contenedor
- N√∫mero de reinicios y fallos de contenedores
- Tiempo de inicio de contenedores
- Vulnerabilidades detectadas en runtime
- Violaciones de pol√≠ticas de seguridad

#### 6.2 Logging de Seguridad

**Eventos a Auditar:**
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: audit-policy
data:
  audit-policy.yaml: |
    apiVersion: audit.k8s.io/v1
    kind: Policy
    rules:
    - level: Metadata
      namespaces: ["production-apps"]
      verbs: ["create", "update", "patch", "delete"]
      resources:
      - group: ""
        resources: ["pods", "services", "secrets"]
    - level: Request
      verbs: ["create", "update", "patch"]
      resources:
      - group: "rbac.authorization.k8s.io"
        resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"]
```

### 7. Respuesta a Incidentes en Contenedores

#### 7.1 Detecci√≥n de Amenazas

**Herramientas de Runtime Security:**
- Falco para detecci√≥n de comportamiento an√≥malo
- Sysdig Secure para visibilidad en runtime
- Aqua Security para protecci√≥n integral
- Twistlock/Prisma Cloud para compliance

#### 7.2 Procedimientos de Respuesta

**Escalamiento Autom√°tico:**
1. **Detecci√≥n:** Sistema de monitoreo detecta anomal√≠a
2. **Aislamiento:** Contenedor sospechoso se a√≠sla autom√°ticamente
3. **An√°lisis:** Forense autom√°tico del contenedor
4. **Notificaci√≥n:** Alerta inmediata al equipo de seguridad
5. **Remediaci√≥n:** Reinicio con imagen limpia si es necesario

## üéØ Roles y Responsabilidades

### DevOps Team Lead
- Implementar y mantener pol√≠ticas de seguridad de contenedores
- Supervisar escaneado de vulnerabilidades
- Gestionar configuraci√≥n segura de orquestadores

### Site Reliability Engineers (SRE)
- Monitorear seguridad en runtime de contenedores
- Responder a incidentes relacionados con contenedores
- Mantener visibilidad y observabilidad

### Development Teams
- Seguir pr√°cticas de construcci√≥n segura de im√°genes
- Implementar principios de seguridad en aplicaciones contenerizadas
- Participar en revisiones de seguridad de contenedores

### CISO (Chief Information Security Officer)
- Aprobar pol√≠ticas de seguridad de contenedores
- Revisar m√©tricas y KPIs de seguridad
- Asegurar cumplimiento con est√°ndares de la industria

## üìä M√©tricas y KPIs

### M√©tricas de Seguridad
- **Tiempo Medio de Detecci√≥n (MTTD):** < 5 minutos para amenazas cr√≠ticas
- **Tiempo Medio de Respuesta (MTTR):** < 15 minutos para incidentes cr√≠ticos
- **Cobertura de Escaneo:** 100% de im√°genes escaneadas antes del despliegue
- **Vulnerabilidades Cr√≠ticas:** 0 vulnerabilidades cr√≠ticas en producci√≥n
- **Compliance Score:** > 95% de cumplimiento con pol√≠ticas de seguridad

### Reportes Requeridos
- **Semanal:** Reporte de vulnerabilidades detectadas y remediadas
- **Mensual:** An√°lisis de tendencias de seguridad en contenedores
- **Trimestral:** Revisi√≥n de efectividad de controles de seguridad
- **Anual:** Evaluaci√≥n completa de madurez de seguridad en contenedores

## üîÑ Procedimientos

### Procedimiento de Despliegue Seguro

1. **Pre-despliegue:**
   - Escaneo de vulnerabilidades de imagen
   - Validaci√≥n de configuraci√≥n de seguridad
   - Revisi√≥n de pol√≠ticas de admisi√≥n

2. **Despliegue:**
   - Aplicaci√≥n de pol√≠ticas de seguridad
   - Configuraci√≥n de monitoreo
   - Validaci√≥n de controles de runtime

3. **Post-despliegue:**
   - Verificaci√≥n de seguridad en runtime
   - Monitoreo continuo de amenazas
   - Actualizaciones autom√°ticas de seguridad

### Procedimiento de Gesti√≥n de Vulnerabilidades

1. **Detecci√≥n:** Escaneo autom√°tico identifica vulnerabilidad
2. **Evaluaci√≥n:** An√°lisis de impacto y riesgo
3. **Priorizaci√≥n:** Clasificaci√≥n seg√∫n criticidad
4. **Remediaci√≥n:** Actualizaci√≥n de imagen base o aplicaci√≥n de parche
5. **Validaci√≥n:** Verificaci√≥n de correcci√≥n efectiva
6. **Despliegue:** Actualizaci√≥n en entornos afectados

## üìö Est√°ndares y Referencias

### Marcos de Referencia
- **NIST Cybersecurity Framework**
- **CIS Kubernetes Benchmark**
- **OWASP Container Security Top 10**
- **ISO 27001/27002**

### Herramientas Aprobadas
- **Escaneo de Vulnerabilidades:** Trivy, Snyk, Anchore
- **Runtime Security:** Falco, Sysdig, Aqua Security
- **Gesti√≥n de Secretos:** HashiCorp Vault, AWS Secrets Manager
- **Monitoreo:** Prometheus, Grafana, ELK Stack

## üö® Incumplimiento

### Clasificaci√≥n de Violaciones
- **Cr√≠tico:** Contenedor con vulnerabilidades cr√≠ticas en producci√≥n
- **Alto:** Violaci√≥n de pol√≠ticas de seguridad de runtime
- **Medio:** Incumplimiento de mejores pr√°cticas de construcci√≥n
- **Bajo:** Falta de documentaci√≥n o configuraci√≥n sub√≥ptima

### Consecuencias
- **Cr√≠tico/Alto:** Remoci√≥n inmediata del contenedor, investigaci√≥n formal
- **Medio:** Correcci√≥n requerida en 48 horas
- **Bajo:** Correcci√≥n requerida en 1 semana

## üìÖ Revisi√≥n y Actualizaci√≥n

Esta pol√≠tica ser√° revisada semestralmente o cuando ocurran cambios significativos en:
- Tecnolog√≠as de contenedores utilizadas
- Amenazas de seguridad identificadas
- Regulaciones o est√°ndares aplicables
- Incidentes de seguridad relacionados con contenedores

**Pr√≥xima revisi√≥n programada:** Julio 2025

---

**Aprobado por:**  
Mar√≠a Gonz√°lez - CISO  
**Fecha:** Enero 2025  

**Revisado por:**  
Carlos Mendoza - DevOps Team Lead  
Ana Rodr√≠guez - SRE Manager  
**Fecha:** Enero 2025
